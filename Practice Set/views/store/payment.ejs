<%- include('../partials/head') %>
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100">
<%- include('../partials/nav') %>

<main class="max-w-3xl mx-auto bg-white p-8 mt-10 rounded-lg shadow">
  <h1 class="text-3xl font-bold text-center mb-6 text-green-600">
    Secure Payment
  </h1>

  <!-- Booking Summary -->
  <div class="mb-6 border rounded-lg p-4 bg-gray-50">
    <h2 class="text-xl font-semibold"><%= booking.homeId.houseName %></h2>
    <p class="text-gray-600"><%= booking.homeId.location %></p>

    <div class="mt-3 space-y-1">
      <p><strong>Check-in:</strong> <%= new Date(booking.checkInDate).toDateString() %></p>
      <p><strong>Check-out:</strong> <%= new Date(booking.checkOutDate).toDateString() %></p>
      <p class="text-2xl font-bold text-red-500 mt-2">
        Amount Payable: â‚¹<%= booking.totalPrice %>
      </p>
    </div>
  </div>

  <!-- Payment Method -->
  <h3 class="text-lg font-semibold mb-4">Choose Payment Method</h3>

  <div class="space-y-3">
    <label class="flex items-center gap-3 cursor-pointer">
      <input type="radio" name="paymentMethod" value="card" checked onchange="togglePayment()">
      ðŸ’³ Card
    </label>

    <label class="flex items-center gap-3 cursor-pointer">
      <input type="radio" name="paymentMethod" value="upi" onchange="togglePayment()">
      ðŸ“± UPI
    </label>
  </div>

  <!-- CARD PAYMENT FORM -->
  <div id="cardForm" class="mt-6 space-y-4">
    <input type="text" placeholder="Card Number (16 digits)"
      class="w-full border p-2 rounded"
      maxlength="16">

    <div class="grid grid-cols-2 gap-4">
      <input type="text" placeholder="MM/YY" class="border p-2 rounded">
      <input type="password" placeholder="CVV" maxlength="3" class="border p-2 rounded">
    </div>

    <input type="text" placeholder="Card Holder Name"
      class="w-full border p-2 rounded">
  </div>

  <!-- UPI PAYMENT FORM -->
  <div id="upiForm" class="mt-6 space-y-4 hidden">
    <input type="text"
      placeholder="Enter UPI ID (e.g. name@upi)"
      class="w-full border p-2 rounded">
  </div>

  <!-- PAY BUTTON -->
  <button
    onclick="validateAndPay()"
    class="w-full bg-green-500 text-white py-3 rounded-lg mt-6 text-lg hover:bg-green-600">
    Pay â‚¹<%= booking.totalPrice %>
  </button>
  
</main>

<!-- SUCCESS MODAL -->
<div id="successModal"
  class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">

  <div class="bg-white rounded-lg p-8 text-center w-80">
    <div class="text-green-500 text-5xl mb-4">âœ”</div>
    <h2 class="text-2xl font-bold mb-2">Payment Successful</h2>
    <p class="text-gray-600 mb-6">Your booking is confirmed</p>

    <form action="/payment/<%= booking._id %>" method="POST">
      <button class="bg-green-500 text-white px-6 py-2 rounded hover:bg-green-600">
        Continue
      </button>
    </form>
  </div>
</div>

<script>
  function togglePayment() {
    const method = document.querySelector('input[name="paymentMethod"]:checked').value;
    document.getElementById("cardForm").classList.toggle("hidden", method !== "card");
    document.getElementById("upiForm").classList.toggle("hidden", method !== "upi");
  }

  function validateAndPay() {
    const method = document.querySelector('input[name="paymentMethod"]:checked').value;

    if (method === "card") {
      const inputs = document.querySelectorAll("#cardForm input");
      for (let input of inputs) {
        if (!input.value.trim()) {
          alert("Please fill all card details");
          return;
        }
      }
    }

    if (method === "upi") {
      const upi = document.querySelector("#upiForm input").value;
      if (!upi.includes("@")) {
        alert("Please enter a valid UPI ID");
        return;
      }
    }

    document.getElementById("successModal").classList.remove("hidden");
  }
</script>

</body>
</html>
