<%- include('../partials/head') %>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  </head>

  <body class="bg-gray-100">
    <%- include('../partials/nav') %>

      <main class="container mx-auto bg-white shadow-lg rounded-lg p-8 mt-10 max-w-3xl">
        <h1 class="text-3xl font-bold text-red-500 mb-6 text-center">Add Review</h1>

        <div class="bg-gray-50 rounded-lg p-4 mb-6">
          <h3 class="font-semibold text-lg mb-2">
            <%= home.houseName %>
          </h3>
          <p class="text-gray-600"><i class="fas fa-map-marker-alt mr-2"></i>
            <%= home.location %>
          </p>
        </div>

        <% if (!hasBooking) { %>
          <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 mb-6">
            <p class="text-yellow-700">You can only review homes you have booked and completed your stay.</p>
          </div>
          <% } %>

            <% if (existingReview) { %>
              <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6">
                <p class="text-blue-700">You have already reviewed this property. Your review will be updated.</p>
              </div>
              <% } %>

                <form action="/homes/<%= home._id %>/review" method="POST" class="space-y-6">
                  <!-- Rating -->
                  <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Rating</label>
                    <div class="flex gap-2">
                      <% for (let i=1; i <=5; i++) { %>
                        <label class="cursor-pointer">
                          <input type="radio" name="rating" value="<%= i %>" required <%=existingReview &&
                            existingReview.rating===i ? 'checked' : '' %>
                          class="hidden star-rating">
                          <i
                            class="fas fa-star text-3xl <%= existingReview && existingReview.rating >= i ? 'text-yellow-400' : 'text-gray-300' %> hover:text-yellow-400 transition"></i>
                        </label>
                        <% } %>
                    </div>
                  </div>

                  <!-- Comment -->
                  <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Your Review</label>
                    <textarea name="comment" rows="6" placeholder="Share your experience..." required
                      class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-red-500 outline-none"><%= existingReview ? existingReview.comment : '' %></textarea>
                  </div>

                  <div class="flex gap-4">
                    <button type="submit" class="bg-red-500 text-white px-6 py-3 rounded-lg">
                      Submit Review
                    </button>
                    <a href="/homes/<%= home._id %>"
                      class="bg-gray-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-gray-600 transition">
                      Cancel
                    </a>
                  </div>
                </form>
      </main>

      <script>
        // Star rating interaction
        document.querySelectorAll('.star-rating').forEach(radio => {
          radio.addEventListener('change', function () {
            const rating = parseInt(this.value);
            const stars = document.querySelectorAll('.fa-star');
            stars.forEach((star, index) => {
              if (index < rating) {
                star.classList.remove('text-gray-300');
                star.classList.add('text-yellow-400');
              } else {
                star.classList.remove('text-yellow-400');
                star.classList.add('text-gray-300');
              }
            });
          });
        });
      </script>

  </body>

  </html>